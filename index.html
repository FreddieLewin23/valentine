<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valentine</title>
  <style>
    :root { --pink:#ff5fa2; }
    body{
      margin:0;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
    }

    /* Pink question box */
    .card{
      width:min(520px, 92vw);
      border:4px solid var(--pink);
      border-radius:18px;
      padding:34px 26px;
      text-align:center;
      background:#ffe6f1;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      position:relative;
      z-index:2;
    }
    h1{ margin:0 0 22px; color:#b4004e; font-size:32px; }

    .btnRow{
      position:relative;
      height:120px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
    }

    button{
      font-size:18px;
      padding:12px 22px;
      border-radius:12px;
      cursor:pointer;
      user-select:none;
    }

    #yes{
      background: var(--pink);
      color:#fff;
      border:0;
      z-index:3;
      position:relative;
    }

    /* The runaway button lives in viewport space */
    #no{
      background:#fff;
      color:#b4004e;
      border:2px solid #ff9ac6;
      position:fixed;
      left:0;
      top:0;
      will-change: left, top;
      z-index:3;
    }

    .huzzah{
      font-size:56px;
      color: var(--pink);
      font-weight:800;
      letter-spacing: 0.5px;
      z-index:2;
    }

    /* Confetti */
    .confetti {
      position: fixed;
      top: -20px;
      left: 0;
      border-radius: 2px;
      z-index: 9999;
      pointer-events: none;
      opacity: 0.95;
      animation-name: confetti-fall;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
    }
    @keyframes confetti-fall {
      0%   { transform: translate3d(var(--x), -20px, 0) rotate(0deg); }
      100% { transform: translate3d(calc(var(--x) + var(--drift)), calc(100vh + 140px), 0) rotate(var(--rot)); }
    }
  </style>
</head>

<body>
  <button id="no" type="button">No</button>

  <div class="card" id="card">
    <h1>Will you be my valentine?</h1>
    <div class="btnRow">
      <button id="yes" type="button">Yes</button>
    </div>
  </div>

  <script>
    (() => {
      const noBtn = document.getElementById("no");
      const yesBtn = document.getElementById("yes");
      const card  = document.getElementById("card");

      // ===== CHAOS TUNING =====
      // The roaming rectangle is 150% of the viewport.
      // That means it can go 25% off each side.
      const OVERSCAN = 0.25;        // 0.25 => 150% roaming region
      const PANIC_RADIUS = 210;     // starts fleeing within this distance (px)
      const KEEP_OUT = 60;          // cursor may never enter this expanded rect around button (px)

      const MAX_SPEED = 620;        // px/s when very close
      const ACCEL = 8500;           // px/s^2, higher = reacts faster
      const DAMPING = 6.5;          // higher = smoother
      const MAX_STEP = 14;          // px per frame cap, prevents teleport jumps

      const WALL_PAD = 90;          // repels from roaming bounds to prevent corner trapping
      const WALL_PUSH_SPEED = 420;  // target speed contribution from wall repulsion
      // ========================

      let bw = 0, bh = 0;
      let x = 0, y = 0;             // top-left in viewport coords
      let vx = 0, vy = 0;           // px/s
      let mx = null, my = null;     // mouse in viewport coords

      let running = true;
      let lastT = null;

      function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }

      function measure() {
        bw = noBtn.offsetWidth;
        bh = noBtn.offsetHeight;
      }

      function bounds() {
        const vw = window.innerWidth;
        const vh = window.innerHeight;

        // Roaming area is 150% of viewport, centered on viewport.
        const minX = -OVERSCAN * vw;
        const minY = -OVERSCAN * vh;
        const maxX = (1 + OVERSCAN) * vw - bw;
        const maxY = (1 + OVERSCAN) * vh - bh;

        return { vw, vh, minX, minY, maxX, maxY };
      }

      function setPos(nx, ny) {
        x = nx; y = ny;
        noBtn.style.left = `${x}px`;
        noBtn.style.top  = `${y}px`;
      }

      function initPos() {
        measure();

        // Start near where a "No" would be next to Yes (roughly)
        const cardRect = card.getBoundingClientRect();
        const startX = cardRect.left + cardRect.width * 0.62 - bw / 2;
        const startY = cardRect.top  + cardRect.height * 0.64 - bh / 2;

        const b = bounds();
        setPos(clamp(startX, b.minX, b.maxX), clamp(startY, b.minY, b.maxY));
        vx = 0; vy = 0;
      }

      window.addEventListener("mousemove", (e) => { mx = e.clientX; my = e.clientY; }, { passive:true });
      window.addEventListener("touchmove", (e) => {
        const t = e.touches[0];
        mx = t.clientX; my = t.clientY;
      }, { passive:true });

      function wallTarget(cx, cy, b) {
        let tvx = 0, tvy = 0;

        const dL = cx - b.minX;
        const dR = b.maxX - cx;
        const dT = cy - b.minY;
        const dB = b.maxY - cy;

        function push(d, ux, uy) {
          if (d < WALL_PAD) {
            const s = (WALL_PAD - d) / WALL_PAD;
            const strength = s * s;
            tvx += ux * (WALL_PUSH_SPEED * strength);
            tvy += uy * (WALL_PUSH_SPEED * strength);
          }
        }

        push(dL, +1, 0);
        push(dR, -1, 0);
        push(dT, 0, +1);
        push(dB, 0, -1);

        return [tvx, tvy];
      }

      function launchConfetti() {
        const colors = ["#ff5fa2", "#ffd1e6", "#ffffff", "#ff9ac6"];
        const count = 260;

        for (let i = 0; i < count; i++) {
          const c = document.createElement("div");
          c.className = "confetti";

          const xvw = Math.random() * 100;
          const driftPx = (Math.random() - 0.5) * 360;
          const rotDeg = (Math.random() * 900 + 360) * (Math.random() < 0.5 ? -1 : 1);
          const dur = 1200 + Math.random() * 1200;

          c.style.background = colors[Math.floor(Math.random() * colors.length)];
          c.style.setProperty("--x", xvw + "vw");
          c.style.setProperty("--drift", driftPx + "px");
          c.style.setProperty("--rot", rotDeg + "deg");
          c.style.animationDuration = dur + "ms";
          c.style.animationDelay = (Math.random() * 200) + "ms";

          c.style.width = (6 + Math.random() * 6) + "px";
          c.style.height = (10 + Math.random() * 10) + "px";

          document.body.appendChild(c);
          c.addEventListener("animationend", () => c.remove());
        }
      }

      function tick(t) {
        if (!running) return;

        if (lastT === null) lastT = t;
        const dt = clamp((t - lastT) / 1000, 0, 0.03);
        lastT = t;

        measure();
        const b = bounds();

        const cx = x + bw / 2;
        const cy = y + bh / 2;

        // Danger zone check: expanded rect around button in viewport coords
        let insideKeepOut = false;
        let dist = Infinity;
        let dx = 0, dy = 0;

        if (mx !== null && my !== null) {
          const left = x - KEEP_OUT;
          const right = x + bw + KEEP_OUT;
          const top = y - KEEP_OUT;
          const bottom = y + bh + KEEP_OUT;

          insideKeepOut = (mx >= left && mx <= right && my >= top && my <= bottom);

          dx = cx - mx;
          dy = cy - my;
          dist = Math.hypot(dx, dy) || 1;
        }

        // Desired velocity away from cursor
        let targetVx = 0, targetVy = 0;

        if (mx !== null && my !== null) {
          const ux = dx / (dist || 1);
          const uy = dy / (dist || 1);

          if (dist < PANIC_RADIUS || insideKeepOut) {
            const s = insideKeepOut ? 1.0 : clamp((PANIC_RADIUS - dist) / PANIC_RADIUS, 0, 1);

            // Very aggressive close-range ramp (fast when close, calmer at edge)
            const strength = insideKeepOut ? 1.6 : Math.pow(s, 0.22);

            const desired = clamp(MAX_SPEED * strength, 0, MAX_SPEED);
            targetVx += ux * desired;
            targetVy += uy * desired;
          }
        }

        // Add wall repulsion so it cannot be pinned at roaming bounds
        const [wvx, wvy] = wallTarget(cx, cy, b);
        targetVx += wvx;
        targetVy += wvy;

        // Cap combined target speed
        const tv = Math.hypot(targetVx, targetVy);
        if (tv > MAX_SPEED) {
          targetVx = (targetVx / tv) * MAX_SPEED;
          targetVy = (targetVy / tv) * MAX_SPEED;
        }

        // If cursor invades keep-out, instantly shove velocity toward target
        if (insideKeepOut) {
          vx = vx * 0.1 + targetVx * 0.9;
          vy = vy * 0.1 + targetVy * 0.9;
        }

        // Accelerate toward target with limit
        const dvx = targetVx - vx;
        const dvy = targetVy - vy;
        const dv = Math.hypot(dvx, dvy) || 1;

        const maxDv = ACCEL * dt;
        const scale = dv > maxDv ? (maxDv / dv) : 1;

        vx += dvx * scale;
        vy += dvy * scale;

        // Damping for smoothness
        vx -= vx * DAMPING * dt * 0.20;
        vy -= vy * DAMPING * dt * 0.20;

        // Integrate with per-frame cap so it never "teleports"
        let stepX = vx * dt;
        let stepY = vy * dt;

        const step = Math.hypot(stepX, stepY) || 1;
        if (step > MAX_STEP) {
          stepX = (stepX / step) * MAX_STEP;
          stepY = (stepY / step) * MAX_STEP;
        }

        let nx = x + stepX;
        let ny = y + stepY;

        // Clamp to roaming bounds, no bouncing
        nx = clamp(nx, b.minX, b.maxX);
        ny = clamp(ny, b.minY, b.maxY);

        setPos(nx, ny);

        // Never allow hover/click when too close
        noBtn.style.pointerEvents = insideKeepOut ? "none" : "auto";

        requestAnimationFrame(tick);
      }

      yesBtn.addEventListener("click", () => {
        running = false;

        card.remove();
        noBtn.remove();

        const h = document.createElement("div");
        h.className = "huzzah";
        h.textContent = "huzzah!";
        document.body.appendChild(h);

        launchConfetti();
      });

      window.addEventListener("resize", initPos);

      initPos();
      requestAnimationFrame(tick);
    })();
  </script>
</body>
</html>





