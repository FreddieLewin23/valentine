<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valentine</title>
  <style>
    :root { --pink:#ff5fa2; }
    body{
      margin:0; height:100vh; display:flex; align-items:center; justify-content:center;
      background:#fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .card{
      width:min(520px, 92vw);
      border:4px solid var(--pink);
      border-radius:18px;
      padding:34px 26px;
      text-align:center;
      background:#ffe6f1;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      position:relative;
    }
    h1{ margin:0 0 22px; color:#b4004e; font-size:32px; }
    .btns{
      position:relative;
      height:120px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      overflow:hidden;
    }
    button{
      font-size:18px;
      padding:12px 22px;
      border-radius:12px;
      cursor:pointer;
      user-select:none;
    }
    #yes{
      background: var(--pink);
      color:#fff;
      border:0;
    }
    #no{
      background:#fff;
      color:#b4004e;
      border:2px solid #ff9ac6;
      position:absolute;
      left:0;
      top:0;
      will-change: left, top;
    }
    .huzzah{
      font-size:56px;
      color: var(--pink);
      font-weight:800;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>
  <div class="card" id="card">
    <h1>Will you be my valentine?</h1>

    <div class="btns" id="arena">
      <button id="yes" type="button">Yes</button>
      <button id="no" type="button">No</button>
    </div>
  </div>

  <script>
    (() => {
      const arena = document.getElementById("arena");
      const noBtn = document.getElementById("no");
      const yesBtn = document.getElementById("yes");
      const card  = document.getElementById("card");

      if (!arena || !noBtn || !yesBtn || !card) {
        // If any IDs don't match, nothing will work.
        console.error("Missing element: check ids arena/no/yes/card");
        return;
      }

      // Button position and velocity (pixels in arena coords)
      let x = 0, y = 0;
      let vx = 0, vy = 0;

      // Cursor position in viewport coords
      let mouseX = null, mouseY = null;

      let running = true;
      let lastT = null;

      function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }

      function setPos(nx, ny) {
        x = nx; y = ny;
        noBtn.style.left = `${x}px`;
        noBtn.style.top  = `${y}px`;
      }

      function initPos() {
        const a = arena.getBoundingClientRect();
        const b = noBtn.getBoundingClientRect();
        setPos((a.width - b.width) / 2, (a.height - b.height) / 2);
        vx = 0; vy = 0;
      }

      function updateMouse(clientX, clientY) {
        mouseX = clientX;
        mouseY = clientY;
      }

      arena.addEventListener("mousemove", (e) => updateMouse(e.clientX, e.clientY), { passive: true });
      arena.addEventListener("touchmove", (e) => {
        const t = e.touches[0];
        updateMouse(t.clientX, t.clientY);
      }, { passive: true });

      function tick(t) {
        if (!running) return;

        if (lastT === null) lastT = t;
        const dt = clamp((t - lastT) / 1000, 0, 0.03);
        lastT = t;

        const a = arena.getBoundingClientRect();
        const b = noBtn.getBoundingClientRect();

        const minX = 0, minY = 0;
        const maxX = Math.max(0, a.width - b.width);
        const maxY = Math.max(0, a.height - b.height);

        // Button centre in viewport coords
        const btnCenterX = b.left + b.width / 2;
        const btnCenterY = b.top  + b.height / 2;

        // Smooth acceleration away from cursor
        let ax = 0, ay = 0;

        const panicRadius = 160; // reacts within this distance
        const maxAccel = 1400;   // lower = calmer
        const maxSpeed = 220;    // lower = slower

        if (mouseX !== null && mouseY !== null) {
          const dx = btnCenterX - mouseX;
          const dy = btnCenterY - mouseY;
          const dist = Math.hypot(dx, dy) || 1;

          if (dist < panicRadius) {
            const s = (panicRadius - dist) / panicRadius; // 0..1
            const strength = s * s; // gentler ramp
            ax = (dx / dist) * (maxAccel * strength);
            ay = (dy / dist) * (maxAccel * strength);
          }
        }

        // Damping for smooth glide
        const damping = 10.0;
        ax += -damping * vx;
        ay += -damping * vy;

        // Integrate
        vx += ax * dt;
        vy += ay * dt;

        // Clamp speed
        const sp = Math.hypot(vx, vy);
        if (sp > maxSpeed) {
          vx = (vx / sp) * maxSpeed;
          vy = (vy / sp) * maxSpeed;
        }

        let nx = x + vx * dt;
        let ny = y + vy * dt;

        // Keep inside bounds with tiny bounce
        const bounce = 0.2;
        if (nx < minX) { nx = minX; vx = -vx * bounce; }
        if (nx > maxX) { nx = maxX; vx = -vx * bounce; }
        if (ny < minY) { ny = minY; vy = -vy * bounce; }
        if (ny > maxY) { ny = maxY; vy = -vy * bounce; }

        setPos(nx, ny);
        requestAnimationFrame(tick);
      }

      function confetti() {
        const colors = ["#ff5fa2", "#ffd1e6", "#ffffff", "#ff9ac6"];
        const count = 180;

        for (let i = 0; i < count; i++) {
          const piece = document.createElement("div");
          piece.style.position = "fixed";
          piece.style.left = Math.random() * 100 + "vw";
          piece.style.top = "-20px";
          piece.style.width = "8px";
          piece.style.height = "14px";
          piece.style.background = colors[Math.floor(Math.random() * colors.length)];
          piece.style.opacity = "0.95";
          piece.style.zIndex = "9999";
          piece.style.borderRadius = "2px";
          document.body.appendChild(piece);

          const fall = window.innerHeight + 120;
          const drift = (Math.random() - 0.5) * 320;
          const rotate = Math.random() * 720;

          piece.animate(
            [
              { transform: "translate(0,0) rotate(0deg)", top: "-20px" },
              { transform: `translate(${drift}px,0) rotate(${rotate}deg)`, top: fall + "px" }
            ],
            {
              duration: 1400 + Math.random() * 900,
              easing: "cubic-bezier(.2,.8,.2,1)"
            }
          ).onfinish = () => piece.remove();
        }
      }

      yesBtn.addEventListener("click", () => {
        running = false; // stop the animation loop cleanly
        card.remove();

        const h = document.createElement("div");
        h.className = "huzzah";
        h.textContent = "huzzah!";
        document.body.appendChild(h);

        confetti();
      });

      window.addEventListener("resize", initPos);

      initPos();
      requestAnimationFrame(tick);
    })();
  </script>
</body>
</html>


